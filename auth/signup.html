<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - Calbiwe</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="shortcut icon" type="image/x-icon" href="../assets/logo.png" />
    <link rel="stylesheet" href="../index.css">
 <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-firestore.js"></script>
</head>
<body id="reg-body" class="auth-bg">
    <main class="auth-cont">
        <div class="auth-cont-left">
            
            <div class="auth-logo-cont">
                <div class="auth-img"> <img src="../assets/logo.gif" alt="logo" style="width: 50px;height: 50px;"></div>
                    <span class="auth-logo-text" style="color: tomato;">
                        Calbiwe
                    </span>
            </div>
            <img src="../assets/auth.webp" alt="" style="width: 500px;">
           </div>
        <div class="auth-cont-right">
            <div class="auth-logo-cont-form">
               
                <div class="auth-img-form"> <img src="../assets/logo.gif" alt="logo"></div>
                    <span class="auth-logo-text-form" style="color: tomato;">
                        Calbiwe
                    </span>
            </div>
            <div class="d-flex flex-column gap-1 w-100">
                <div class="auth-title" style="color: rgba(255, 99, 71, 0.904); font-size: 14px;">Register your hospital</div>
                <div class="auth-title" style="color: teal;">Sign up</div>
            </div>
            
            <div class="auth-form " style="height: 350px;">
               <div class="form-floating  auth-input-cont">
                    <input type="text" class="form-control" id="name" placeholder="John Doe">
                    <label id="namelabel" for="name">Fullname</label>
                  </div>
                  <div class="form-floating  auth-input-cont">
                    <input type="text" class="form-control" id="hospital" placeholder="hospital">
                    <label id="hospitalabel" for="hospital">Hospital name</label>
                  </div>
                  <div class="form-floating  auth-input-cont">
                    <input type="text" class="form-control" id="location" placeholder="location">
                    <label id="locationlabel" for="location">Hospital address</label>
                  </div>
                  <div class="form-floating  auth-input-cont">
                    <input type="email" class="form-control" id="email" placeholder="name@example.com">
                    <label id="emailabel" for="email">Email address</label>
                  </div>
                <button id="signup">Next</button>
            </div>
            <div class="auth-signin-sub">
                <div class="auth-signin-sub-child" style="color: teal;">Already registered hospital? <a href="../login.html">Sign in</a></div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!--script>
        $(document).ready(function () {
            $("#signup").click(function () {
                

                // Get user input
                var name = $("#name").val();
                var email = $("#email").val();
                var hospital = $("#hospital").val();
                var address = $("#location").val();
                var users = JSON.parse(localStorage.getItem("users")) || [];

                // Validate inputs
                var isValid = true;
                $("#namelabel").text("Fullname");
                $("#emailabel").text("Email address");
                $("#hospitalabel").text("Hospital name");
                $("#locationlabel").text("Hospital address");

                if (name === "") {
                    $("#namelabel").text("Your fullname is required*");
                    $("#namelabel").css("color","tomato");
                    isValid = false;
                }

                if (hospital === "") {
                    $("#hospitalabel").text("Hospital name is required*");
                    $("#hospitalabel").css("color","tomato");
                    isValid = false;
                }

                if (email === "" || !isValidEmail(email)) {
                    $("#emailabel").text("Valid email is required*");
                    $("#emailabel").css("color","tomato");
                    isValid = false;
                }

                if (address === "") {
                    $("#locationlabel").text("Hospital address is required*");
                    $("#locationlabel").css("color","tomato");
                    isValid = false;
                }

                // If validation passes, log user credentials to the console
                if (isValid) {
                    var user = {
                        name: name,
                        email: email,
                        hospital: hospital,
                        address: address
                    };
                    console.log(user);
                      // Check if email already exists
                if (users.some(user => user.hospital === hospital)) {
                    const newParagraph = $(`<div class="alert">
        <i class="fa fa-exclamation d-flex align-items-center  justify-content-center" style="width:40px;height:40px;color:white; border-radius:50%; background:teal;"></i>
        <div class="alert-text-danger">Hospital already registered</div>
    </div>`);
    newParagraph.css("top", "-50px");
                    $("#reg-body").append(newParagraph);
                       // Use setTimeout to give the browser time to apply the initial top value
            setTimeout(function () {
                newParagraph.css("top", "70px");
            }, 0);
                    setTimeout(function(){
      newParagraph.remove();
    }, 2000);

                } else {
                    // Add new user to the array
                    users.push({  name: name,
                        email: email,
                        hospital: hospital,
                        address: address });

                    // Save users to localStorage
                    localStorage.setItem("userh", hospital);
                    localStorage.setItem("users", JSON.stringify(users));
                    const newParagra = $(`<div class="alert">
                        <i class="fa fa-check d-flex align-items-center  justify-content-center" style="width:40px;height:40px;color:white; border-radius:50%; background:teal;"></i>
        <div class="alert-text">Saved Successfully</div>
    </div>`);
    newParagra.css("top", "-50px");
                    $("#reg-body").append(newParagra);
                      // Use setTimeout to give the browser time to apply the initial top value
            setTimeout(function () {
                newParagra.css("top", "70px");
            }, 0);
                    setTimeout(function(){
      newParagra.remove();
      window.location.href="reg.html"
    }, 2000);          

                }
                }
            });
      // Function to validate email format
      function isValidEmail(email) {
                var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }
        });
    </script-->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
    import { getDatabase, ref, update, remove} from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";
    var adm, bal, use, btn, btnDel;
    adm = document.getElementById('adm');
    bal = document.getElementById('bal');
    btn = document.getElementById('btn');
    btnDel = document.getElementById('btn-del');
    use = document.getElementById('use');
    // Initialize Firebase
    const firebaseConfig = {
          apiKey: "AIzaSyACQcdYNFIvnnahAUWQQJhioJYMYrrW_VE",
          authDomain: "insure-8082d.firebaseapp.com",
          databaseURL: "https://insure-8082d-default-rtdb.firebaseio.com",
          projectId: "insure-8082d",
          storageBucket: "insure-8082d.appspot.com",
          messagingSenderId: "524758809898",
          appId: "1:524758809898:web:f52528d42244829a917253"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
</script>

  <script>
    $(document).ready(function () {
        $("#signup").click(function () {
            // Get user input
            var name = $("#name").val();
            var email = $("#email").val();
            var hospital = $("#hospital").val();
            var address = $("#location").val();
            
            // Validate inputs
            var isValid = true;
            $("#namelabel").text("Fullname");
            $("#emailabel").text("Email address");
            $("#hospitalabel").text("Hospital name");
            $("#locationlabel").text("Hospital address");

            if (name === "") {
                $("#namelabel").text("Your fullname is required*");
                $("#namelabel").css("color","tomato");
                isValid = false;
            }

            if (hospital === "") {
                $("#hospitalabel").text("Hospital name is required*");
                $("#hospitalabel").css("color","tomato");
                isValid = false;
            }

            if (email === "" || !isValidEmail(email)) {
                $("#emailabel").text("Valid email is required*");
                $("#emailabel").css("color","tomato");
                isValid = false;
            }

            if (address === "") {
                $("#locationlabel").text("Hospital address is required*");
                $("#locationlabel").css("color","tomato");
                isValid = false;
            }

            // If validation passes, create user in Firebase Auth and Firestore
            if (isValid) {
                auth.createUserWithEmailAndPassword(email, "defaultPassword")
                    .then((userCredential) => {
                        var user = userCredential.user;
                        // Add user data to Firestore
                        db.collection("users").doc(user.uid).set({
                            name: name,
                            email: email,
                            hospital: hospital,
                            address: address
                        })
                        .then(() => {
                            console.log("User successfully created and data stored!");
                            alert("User successfully created and data stored!");
                        })
                        .catch((error) => {
                            console.error("Error storing user data: ", error);
                        });
                    })
                    .catch((error) => {
                        var errorCode = error.code;
                        var errorMessage = error.message;
                        console.error("Error creating user: ", errorCode, errorMessage);
                    });
            }
        });

        // Function to validate email format
        function isValidEmail(email) {
            var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
    });
</script>
</body>
</html>
